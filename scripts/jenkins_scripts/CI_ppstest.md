#These scripts are written in the Jenkins projects under Build option (Execute shell)
cd /home/timing

if [ -d ci_cd ]; then
   rm -rf ci_cd
fi
git clone https://github.com/GSI-CS-CO/ci_cd.git
git submodule init
git submodule update --recursive

cd ci_cd/scripts/ci_testing/pps
#Counter to check how many times the difference value for the PPS signals generated by different form factors has exceeded set value (Ex:200ns)
counter=0

#Send error notification to below mentioned email address
mail=a.suresh@gsi.de,a.hahn@gsi.de,c.prados@gsi.de


#Value to repeat the PPS test. Each test is executed for 5 min, therefore, repeat test for 5*10=50 min
for i in 1 2 3 4 5 6 7 8 9 10
do
. ./saftppstest.sh exp_config
. ./saftppscompare.sh exp_config

#$temp_count is an exported parameter value from the pps scripts
if [ $temp_count == 1 ]; then
        counter="$(($counter+1))"
fi

if [ $counter == '1' ]; then
        echo "CI PPS test result: Time difference between switch and timing receiver greater than $maxdiff ns exists" | mail -s “ci_pps_test_delay_error” $mail
fi
echo "Counter value= $counter"
done
echo "Time difference value exceeded $maxdiff ns $counter times"
